http {
    lua_package_path "/path/to/lua/scripts/?.lua;;";

    server {
        listen 80;

        access_by_lua_block {
            local tracer = require("tracing_script")
            tracer:start_span()
        }

        location / {
            # existing server configuration
        }

        log_by_lua_block {
            local tracer = require("tracing_script")
            local span = tracer:end_span()
            local formatted_data = format_trace_data(span)
            send_trace_to_collector(formatted_data)
        }
    }

    # Other server configurations

